---
index: 2
title: React父子组件的渲染机制
description: React父子组件是如何渲染的，谁先渲染，谁后渲染，重新渲染如何影响其他组件？
author: 杨飞
tags: [react, 优化, 父子组件, 组件渲染]
date: 2024-02-22 14:30:00
---

> React父子组件是如何渲染的，谁先渲染，谁后渲染，重新渲染如何影响其他组件？
>
> 相信这个问题，对很多同学来说，都是一个模糊的概念，下面我来给大家梳理一下这里面的机制吧。

#### 一、父子组件是如何渲染的？

`react`的渲染机制是由上至下的过程。父组件会先进行渲染，然后才是子组件。这个过程，可以简单分为以下几个步骤：

- 父组件返回的`jsx`中，`react`发现了子组件的引用。
- `react`调用子组件函数，开始构建或更新子组件的`DOM`。
- 子组件渲染完成后，`react`将其插入到父组件的`DOM`结构中。

这种从上往下的渲染流程，保证了数据流的一致性和组件生命周方法的正确执行顺序。

这也是为什么父组件的更新，可能会触发子组件的重新渲染，因为子组件是父组件的一部分。

不过，在一些特殊情况下，react 内部可能会根据实际情况，优化渲染流程。但基本上你可以按上面的流程去理解渲染逻辑。

#### 二、组件如何触发重新渲染？

react 组件重新渲染，主要是3种情况：

- state 更新

- props 更新
  > 父组件的函数更新，或者重新创建（如`匿名函数`、`字面量`），也算更新哦。

- 强制更新
  > 函数式组件不存在这个东西(函数式组件，可以通过一个特定的 state, 来模拟强制更新)，类组件时代的产物。它违背了`React`声明式编程的原则，所以了解即可。
  >
  > 大多数情况下，你可以通过合理地使用状态和属性来让React自然地更新DOM。强制更新通常用于不受React控制的外部变化集成的情况。

#### 三、父组件重新渲染会导致子组件跟着一起重新渲染吗?

如果使用`memo`来包裹，那么`react`会对`props`的前后数据进行浅层比较，如果没有改变，react 将会跳过这个子组件的渲染过程。

如果不使用`memo`，分为两种情况：

- 使用了父组件传值的情况下，即是传值没有发生任何改变，子组件也会执行重新渲染逻辑。

  这是因为在`React`的默认行为中，组件重新渲染会导致它的整个函数体被重新执行，包括渲染子组件的部分。

- 子组件没有接受父组件的任何传值，自给自足的情况下。

  那么父组件重新渲染的时候，会尝试调用子组件的渲染函数，然后通过虚拟 dom 的对比来决定是否要更新子组件的`dom`.

#### 四、子组件的重新渲染，会导致父组件跟着一起重新渲染吗？

分两种情况：

- 当子组件自己管理内部的 state，同时也没有接受父组件的传值。

  这种情况下，父组件不会受子组件影响。

- 子组件使用了状态提升的数据状态管理模式。

  如果子组件更新了父组件的传入值（父组件提供了`state`和`setState`），不仅仅子组件自身会重新渲染，父组件也会因为`state`被改变而重新渲染。

  当然了，整个渲染流程还是从父组件开始的。
